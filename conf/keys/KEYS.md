[//]: # (Для генерации PDF нужен установленный pandoc + latex. Команды сборки в файле generate.cmd)

# API единой авторизации
#### Версия 2.0

## Общие положения

### Состав документа
API единой авторизации (далее - *API*) предоставляет набор методов, необходимых для
авторизации пользователей в системах компании, а также методы управление пользователями.

#### Генерация ключевой пары
Для генерации ключевой пары приложения можно воспользоваться командами OpenSSL.

##### Создание ключей в формате PEM
###### V1
Для создания RSA-ключей в формате `PEM` можно выполнить следующие команды:
```bash
openssl genrsa -des3 -out encrypted.pem 2048
openssl rsa -in encrypted.pem -outform PEM -pubout -out public.pem
openssl rsa -in encrypted.pem -out private.pem -outform PEM
```

###### V2
Увеличение длины ключа: Увеличение длины ключа RSA делает его более устойчивым к взлому. 
2048 бит является надежным выбором на сегодняшний день, но для дополнительной безопасности можно рассмотреть 
использование ключа длиной 3072 или даже 4096 бит.

Использование -des3 обеспечивает шифрование закрытого ключа с помощью алгоритма 3DES, который считается достаточно безопасным, 
но есть более новые и более надежные алгоритмы. Например, можно использовать -aes256 для более сильного шифрования 
закрытого ключа:
```bash
openssl genrsa -aes256 -out encrypted.pem 4096
openssl rsa -in encrypted.pem -outform PEM -pubout -out public.pem
openssl rsa -in encrypted.pem -out private.pem -outform PEM
```
После выполнения этих команд будут сформированы файлы:

* `encrypted.pem` - зашифрованный закрытый ключ;
* `private.pem` - закрытый ключ без шифрования;
* `public.pem` - открытый ключ.

Так же, для генерации ключевых пар, используя ECDSA или Ed25519, можем использовать openssl команды. 
Ключевым отличием будет выбор алгоритма и, в случае ECDSA, выбор конкретной эллиптической кривой.

Генерация ECDSA ключей
Для ECDSA, первым шагом является выбор эллиптической кривой. 
Доступные кривые можно проверить с помощью команды openssl ecparam -list_curves. 
В качестве примера, давайте использовать кривую prime256v1, которая соответствует стандарту NIST P-256 и обеспечивает 
хороший баланс между безопасностью и производительностью.
```bash
# Генерация ECDSA ключевой пары
openssl ecparam -name prime256v1 -genkey -noout -out ecdsa_private.pem
openssl ec -in ecdsa_private.pem -pubout -out ecdsa_public.pem
```

Генерация Ed25519 ключей
Для генерации ключей, используя Ed25519, процесс несколько проще, поскольку не требуется выбирать кривую:
```bash
# Генерация Ed25519 ключевой пары
openssl genpkey -algorithm Ed25519 -out private.pem
openssl pkey -in private.pem -pubout -out public.pem
```
Криптосистемы на базе эллиптических кривых, как ECDSA и Ed25519, обеспечивают высокий уровень 
безопасности при меньшей длине ключей по сравнению с RSA, что делает их более эффективными 
во многих сценариях использования, включая высокопроизводительные и ограниченные по 
ресурсам системы.

#### Форматы PEM и DER
- PEM (Privacy Enhanced Mail) - это формат, используемый для хранения и обмена криптографическими ключами, 
сертификатами и другими данными. 
Обычно содержимое PEM закодировано в base64 и заключено между строками 
"-----BEGIN ...-----" и "-----END ...-----", что делает его легко читаемым для человека. 
Можно встретить PEM-файлы с расширениями .pem, .cer, .cert и др.

- DER (Distinguished Encoding Rules) - это бинарный формат для хранения тех же самых данных, что и PEM. 
Он используется в системах и приложениях, где предпочтительнее компактное и однозначное представление данных без 
лишних кодирований и обрамлений, что делает его идеальным для использования в средах с ограниченными ресурсами, там, 
где важна скорость обработки данных.

##### Конвертация ключей в формат DER

Процедура конвертации
Передача из PEM в DER это переход от базового текстового формата с кодировкой base64 к более простому и компактному 
бинарному представлению данных. Процедура конвертации включает следующие шаги:
- Конвертация приватного ключа
- Конвертация публичного ключа, используя приватный

RSA 

Для более удобного использования в приложениях, RSA-ключи могут быть сконвертированы в формат DER.

Для приватного ключа, openssl pkcs8 используется для преобразования ключа из стандартного PEM формата в формат PKCS#8, 
который поддерживает различные типы ключей, включая RSA. Опция -topk8 указывает на преобразование в формат PKCS#8. 
Параметры -inform PEM и -outform DER указывают на форматы исходного и целевого файла соответственно, 
а nocrypt означает, что преобразованный ключ не будет зашифрован. Результат сохраняется в private.der.

Для публичного ключа, openssl rsa используется для работы с RSA-ключами. Параметр -in private.pem указывает на 
исходный файл с приватным ключом, из которого будет извлечен публичный. Опция -pubout говорит о том, что нужно 
извлечь публичный ключ. Параметр -outform DER определяет, что результат должен быть в формате DER, и результат 
сохраняется в файл public.der.

Для конвертации созданных на предыдущем этапе ключей в формат DER, могут быть выполнены следующие команды:
```bash
openssl pkcs8 -topk8 -inform PEM -outform DER -in private.pem -nocrypt > private.der
openssl rsa -in private.pem -out public.der -outform DER -pubout
```

Ed25519

```bash
openssl pkcs8 -topk8 -inform PEM -outform DER -in private.pem -nocrypt > private.der
openssl pkey -in private.pem -out public.der -outform DER -pubout
```

Полученные файл ключей `private.der` и `public.der` можно использовать в приложениях без дополнительной конвертации.
